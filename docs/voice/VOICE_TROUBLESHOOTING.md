# 🎤 语音功能故障排查

## 问题：浏览器不支持语音功能

### 原因分析

浏览器的语音功能需要两个 API：
1. **Web Speech API (语音识别)** - 用于语音输入
2. **Speech Synthesis API (语音合成)** - 用于朗读文本

### 浏览器兼容性

#### ✅ 完全支持
- **Chrome/Edge (桌面端)** - 完全支持
- **Safari (iOS/macOS)** - 完全支持

#### ⚠️ 部分支持
- **Firefox** - 仅支持语音合成，不支持语音识别
- **Chrome (Android)** - 支持，但可能需要网络连接

#### ❌ 不支持
- **微信内置浏览器** - 不支持
- **QQ浏览器** - 部分不支持
- **旧版浏览器** - 不支持

## 解决方案

### 方案1: 使用推荐浏览器（最佳）

**桌面端**:
- Chrome 浏览器（推荐）
- Microsoft Edge
- Safari (macOS)

**移动端**:
- Safari (iOS) - 推荐
- Chrome (Android)

### 方案2: 检查浏览器设置

#### Chrome/Edge 设置

1. **检查麦克风权限**
   - 地址栏左侧点击锁图标
   - 确保"麦克风"设置为"允许"

2. **检查语音设置**
   - 设置 → 隐私和安全 → 网站设置
   - 麦克风 → 确保网站有权限
   - 声音 → 确保允许网站播放声音

3. **清除缓存**
   - Ctrl+Shift+Delete
   - 清除缓存和Cookie
   - 重新加载页面

#### Safari (iOS) 设置

1. **检查麦克风权限**
   - 设置 → Safari → 麦克风
   - 确保设置为"询问"或"允许"

2. **检查静音开关**
   - 确保手机侧面的静音开关关闭
   - 调高音量

### 方案3: 测试语音功能

打开浏览器控制台（F12），运行以下代码测试：

```javascript
// 测试语音合成（朗读）
const utterance = new SpeechSynthesisUtterance('Hello, this is a test')
speechSynthesis.speak(utterance)

// 测试语音识别
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition
if (SpeechRecognition) {
  console.log('✅ 支持语音识别')
} else {
  console.log('❌ 不支持语音识别')
}

// 测试语音合成
if ('speechSynthesis' in window) {
  console.log('✅ 支持语音合成')
} else {
  console.log('❌ 不支持语音合成')
}
```

### 方案4: 使用 HTTPS

某些浏览器要求在 HTTPS 环境下才能使用麦克风：

**当前环境**: `http://192.168.1.245:5173`
- 局域网 HTTP 通常允许使用麦克风
- 如果不行，需要配置 HTTPS

## 常见问题

### Q1: 点击"语音回复"没反应

**检查**:
1. 打开控制台（F12）
2. 看是否有错误信息
3. 检查是否弹出麦克风权限请求

**解决**:
- 刷新页面重试
- 检查浏览器权限设置
- 尝试其他浏览器

### Q2: 没有声音朗读

**检查**:
1. 系统音量是否打开
2. 浏览器是否静音
3. 控制台是否有"开始朗读"日志

**解决**:
- 调高音量
- 检查浏览器音频设置
- 尝试手动测试：
  ```javascript
  speechSynthesis.speak(new SpeechSynthesisUtterance('test'))
  ```

### Q3: 语音识别不准确

**原因**:
- 环境噪音
- 发音不清晰
- 网络延迟

**解决**:
- 在安静环境使用
- 说话清晰，语速适中
- 使用完整的英语句子
- 确保网络连接稳定

### Q4: 移动端语音功能异常

**iOS (Safari)**:
- 确保 iOS 14+
- 检查 Safari 设置
- 尝试重启 Safari

**Android (Chrome)**:
- 确保 Chrome 最新版本
- 检查 Google 语音服务
- 确保网络连接

## 调试信息

打开控制台查看以下信息：

```
✅ 语音功能已启用          - 浏览器支持
⚠️ 浏览器不支持语音功能   - 浏览器不支持
🎤 开始监听...            - 语音识别开始
🎤 识别结果: "..."        - 识别成功
开始朗读                  - 开始朗读文本
朗读结束                  - 朗读完成
```

## 替代方案

如果浏览器不支持语音功能，可以：

1. **使用文字对话**
   - 点击"💬 继续对话"
   - 使用文字输入

2. **更换浏览器**
   - 使用 Chrome 或 Safari
   - 确保浏览器是最新版本

3. **使用桌面端**
   - 桌面端浏览器支持更好
   - 访问 `http://localhost:5173`

## 推荐配置

### 最佳体验
- **浏览器**: Chrome 90+ 或 Safari 14+
- **系统**: Windows 10+, macOS 11+, iOS 14+
- **网络**: 稳定的 WiFi 连接
- **环境**: 安静的环境

### 最低要求
- **浏览器**: Chrome 80+ 或 Safari 13+
- **系统**: Windows 8+, macOS 10.15+, iOS 13+
- **网络**: 任何网络连接
- **环境**: 可接受的噪音水平

## 技术支持

如果以上方法都无法解决，请提供：

1. **浏览器信息**
   - 浏览器名称和版本
   - 操作系统版本

2. **控制台日志**
   - 打开控制台（F12）
   - 复制所有错误信息

3. **测试结果**
   - 运行上面的测试代码
   - 提供测试结果

---

**注意**: 语音功能是可选的，即使不支持也可以使用文字进行对话学习。
