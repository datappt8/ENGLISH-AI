# 🔥 Windows防火墙配置指南

## 问题：手机显示 Network Error

### 原因
Windows防火墙默认阻止外部设备访问电脑的端口。

## ✅ 解决方案

### 方法1: 允许端口（推荐）

#### 1. 打开Windows防火墙设置
```
控制面板 → 系统和安全 → Windows Defender 防火墙 → 高级设置
```

#### 2. 添加入站规则 - 端口5000（后端）

1. 点击左侧"入站规则"
2. 点击右侧"新建规则"
3. 选择"端口" → 下一步
4. 选择"TCP"，输入端口 `5000` → 下一步
5. 选择"允许连接" → 下一步
6. 全部勾选（域、专用、公用）→ 下一步
7. 名称输入 `English Quest Backend` → 完成

#### 3. 添加入站规则 - 端口5173（前端）

重复上述步骤，端口改为 `5173`，名称改为 `English Quest Frontend`

### 方法2: 快速命令（管理员权限）

打开**管理员权限**的PowerShell或CMD：

```powershell
# 允许端口5000（后端）
netsh advfirewall firewall add rule name="English Quest Backend" dir=in action=allow protocol=TCP localport=5000

# 允许端口5173（前端）
netsh advfirewall firewall add rule name="English Quest Frontend" dir=in action=allow protocol=TCP localport=5173
```

### 方法3: 临时关闭防火墙（不推荐）

**仅用于测试**，不建议长期使用：

1. 控制面板 → Windows Defender 防火墙
2. 点击"启用或关闭Windows Defender防火墙"
3. 专用网络设置 → 关闭防火墙
4. 公用网络设置 → 关闭防火墙

⚠️ **测试完成后记得重新开启！**

## 🧪 测试防火墙配置

### 在手机上测试

1. **测试后端连接**

   在手机浏览器输入：
   ```
   http://192.168.1.245:5000/api
   ```

   ✅ 应该看到：`{"success":false,"error":{"code":"NOT_FOUND"...}}`
   ❌ 如果无法访问，说明防火墙还在阻止

2. **测试前端连接**

   在手机浏览器输入：
   ```
   http://192.168.1.245:5173
   ```

   ✅ 应该看到游戏页面
   ❌ 如果无法访问，说明防火墙还在阻止

## 🔍 其他可能的问题

### 1. 路由器防火墙

某些路由器也有防火墙功能，可能阻止设备间通信。

**解决**：
- 登录路由器管理页面
- 查找"AP隔离"或"客户端隔离"设置
- 确保已关闭

### 2. 杀毒软件防火墙

如360、腾讯管家等也可能阻止连接。

**解决**：
- 在杀毒软件中添加信任程序
- 或临时关闭杀毒软件测试

### 3. VPN或代理

如果电脑开启了VPN，可能影响局域网访问。

**解决**：
- 临时关闭VPN
- 或配置VPN允许局域网访问

## 📋 完整检查清单

- [ ] 手机和电脑在同一WiFi
- [ ] 电脑IP地址正确（192.168.1.245）
- [ ] Windows防火墙已允许端口5000和5173
- [ ] 路由器未开启AP隔离
- [ ] 杀毒软件未阻止
- [ ] 未使用VPN或已配置允许局域网
- [ ] 后端服务正在运行
- [ ] 前端服务正在运行

## 🚀 验证步骤

### 1. 在电脑上测试（应该都能访问）

```bash
# 测试后端
curl http://localhost:5000/api
curl http://192.168.1.245:5000/api

# 测试前端
curl http://localhost:5173
curl http://192.168.1.245:5173
```

### 2. 在手机上测试

**测试后端**：
```
http://192.168.1.245:5000/api
```

**测试前端**：
```
http://192.168.1.245:5173
```

## 💡 推荐配置

### 开发环境（当前）
- 允许端口5000和5173
- 仅在专用网络（家庭WiFi）开启
- 公用网络保持防火墙开启

### 生产环境（未来）
- 使用HTTPS（443端口）
- 配置域名
- 使用云服务器
- 不需要配置本地防火墙

## 📞 还是不行？

如果配置后还是无法访问，请提供：

1. **防火墙状态**
   ```powershell
   netsh advfirewall show allprofiles
   ```

2. **端口监听状态**
   ```bash
   netstat -ano | findstr :5000
   netstat -ano | findstr :5173
   ```

3. **手机浏览器错误信息**
   - 截图或详细描述

4. **电脑系统信息**
   - Windows版本
   - 是否有杀毒软件
   - 是否使用VPN

---

**配置完成后，刷新手机浏览器重试！** 📱✨
