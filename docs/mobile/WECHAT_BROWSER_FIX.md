# å¾®ä¿¡æµè§ˆå™¨å…¼å®¹æ€§ä¿®å¤

## é—®é¢˜æè¿°

åœ¨å¾®ä¿¡å†…ç½®æµè§ˆå™¨ä¸­ï¼ŒPhaser Canvas æŒ‰é’®ç‚¹å‡»å­˜åœ¨åæ ‡åç§»é—®é¢˜ï¼Œå¯¼è‡´æŒ‰é’®æ— æ³•å‡†ç¡®ç‚¹å‡»ã€‚

## æ ¹æœ¬åŸå› 

1. **åæ ‡ç³»ç»Ÿä¸ä¸€è‡´**: Phaser ä½¿ç”¨ `Scale.FIT` æ¨¡å¼æ—¶ï¼Œæ¸¸æˆé€»è¾‘åæ ‡ï¼ˆ1280x720ï¼‰å’Œå®é™…å±å¹•åæ ‡ä¸åŒ
2. **å¾®ä¿¡æµè§ˆå™¨é™åˆ¶**: å¾®ä¿¡æµè§ˆå™¨å¯¹ Canvas äº‹ä»¶å¤„ç†æœ‰ç‰¹æ®Šé™åˆ¶
3. **æ¨ªå±æ¨¡å¼**: å…¨å±æ¨ªå±æ—¶ï¼Œåæ ‡è½¬æ¢æ›´åŠ å¤æ‚

## è§£å†³æ–¹æ¡ˆ

ä½¿ç”¨ **DOM æŒ‰é’®** ä»£æ›¿ **Canvas æŒ‰é’®**ï¼Œå®Œå…¨é¿å¼€åæ ‡è½¬æ¢é—®é¢˜ã€‚

### ä¼˜åŠ¿

âœ… **å®Œç¾å…¼å®¹**: é€‚ç”¨äºæ‰€æœ‰æµè§ˆå™¨ï¼ˆChromeã€Safariã€å¾®ä¿¡ã€QQæµè§ˆå™¨ç­‰ï¼‰
âœ… **æ— åæ ‡é—®é¢˜**: DOM ä½¿ç”¨å›ºå®šå®šä½ï¼Œä¸å— Canvas ç¼©æ”¾å½±å“
âœ… **è§¦æ‘¸å‹å¥½**: åŸç”Ÿ HTML æŒ‰é’®ï¼Œè§¦æ‘¸åé¦ˆæ›´å¥½
âœ… **æ˜“äºè°ƒè¯•**: å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­æŸ¥çœ‹å’Œè°ƒè¯•
âœ… **æ€§èƒ½æ›´å¥½**: DOM æŒ‰é’®ä¸éœ€è¦æ¯å¸§é‡ç»˜

### å®ç°æ–¹å¼

```typescript
// åˆ›å»º DOM æŒ‰é’®å®¹å™¨
const container = document.createElement('div')
container.style.cssText = `
  position: fixed;
  bottom: 250px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10000;
`

// åˆ›å»ºæŒ‰é’®
const button = document.createElement('button')
button.style.cssText = `
  width: 260px;
  height: 50px;
  background: rgba(102, 126, 234, 0.9);
  color: white;
  border-radius: 10px;
  touch-action: manipulation;
`

button.onclick = () => {
  // å¤„ç†ç‚¹å‡»
}

document.body.appendChild(container)
```

## æŠ€æœ¯ç»†èŠ‚

### 1. å®šä½æ–¹å¼

- ä½¿ç”¨ `position: fixed` ç›¸å¯¹äºè§†å£å®šä½
- ä½¿ç”¨ `left: 50%` + `transform: translateX(-50%)` å®ç°æ°´å¹³å±…ä¸­
- ä½¿ç”¨ `bottom: 250px` å›ºå®šè·ç¦»åº•éƒ¨çš„ä½ç½®

### 2. è§¦æ‘¸ä¼˜åŒ–

```css
touch-action: manipulation;  /* ç¦ç”¨åŒå‡»ç¼©æ”¾ */
-webkit-tap-highlight-color: transparent;  /* ç§»é™¤ç‚¹å‡»é«˜äº® */
user-select: none;  /* ç¦æ­¢æ–‡æœ¬é€‰æ‹© */
```

### 3. äº‹ä»¶å¤„ç†

```typescript
// ç‚¹å‡»äº‹ä»¶
button.onclick = (e) => {
  e.preventDefault()
  e.stopPropagation()
  // å¤„ç†é€»è¾‘
}

// è§¦æ‘¸åé¦ˆ
button.ontouchstart = () => {
  button.style.background = 'rgba(118, 75, 162, 0.9)'
}
button.ontouchend = () => {
  button.style.background = 'rgba(102, 126, 234, 0.9)'
}
```

### 4. å“åº”å¼å¸ƒå±€

```typescript
const isMobile = window.innerWidth < 768

if (isMobile) {
  // ç§»åŠ¨ç«¯ï¼šå‚ç›´å¸ƒå±€
  container.style.flexDirection = 'column'
  button.style.width = '260px'
  button.style.height = '50px'
} else {
  // æ¡Œé¢ç«¯ï¼šæ°´å¹³å¸ƒå±€
  container.style.flexDirection = 'row'
  button.style.width = '170px'
  button.style.height = '45px'
}
```

## æµè§ˆå™¨å…¼å®¹æ€§

| æµè§ˆå™¨ | å…¼å®¹æ€§ | è¯´æ˜ |
|--------|--------|------|
| Chrome | âœ… å®Œç¾æ”¯æŒ | æ‰€æœ‰åŠŸèƒ½æ­£å¸¸ |
| Safari | âœ… å®Œç¾æ”¯æŒ | iOS/macOS éƒ½æ”¯æŒ |
| Edge | âœ… å®Œç¾æ”¯æŒ | åŸºäº Chromium |
| å¾®ä¿¡æµè§ˆå™¨ | âœ… å®Œç¾æ”¯æŒ | DOM æŒ‰é’®æ— åæ ‡é—®é¢˜ |
| QQæµè§ˆå™¨ | âœ… å®Œç¾æ”¯æŒ | DOM æŒ‰é’®æ— åæ ‡é—®é¢˜ |
| Firefox | âœ… å®Œç¾æ”¯æŒ | æ‰€æœ‰åŠŸèƒ½æ­£å¸¸ |

## å¯¹æ¯”ï¼šCanvas æŒ‰é’® vs DOM æŒ‰é’®

| ç‰¹æ€§ | Canvas æŒ‰é’® | DOM æŒ‰é’® |
|------|------------|----------|
| åæ ‡ç³»ç»Ÿ | å¤æ‚ï¼ˆéœ€è¦è½¬æ¢ï¼‰ | ç®€å•ï¼ˆå›ºå®šå®šä½ï¼‰ |
| å¾®ä¿¡å…¼å®¹ | âŒ æœ‰é—®é¢˜ | âœ… å®Œç¾ |
| è§¦æ‘¸åé¦ˆ | éœ€è¦æ‰‹åŠ¨å®ç° | åŸç”Ÿæ”¯æŒ |
| æ€§èƒ½ | æ¯å¸§é‡ç»˜ | åªåœ¨äº¤äº’æ—¶æ›´æ–° |
| è°ƒè¯•éš¾åº¦ | å›°éš¾ | ç®€å• |
| æ ·å¼æ§åˆ¶ | æœ‰é™ | å®Œå…¨æ§åˆ¶ |

## ä½¿ç”¨å»ºè®®

### ä½•æ—¶ä½¿ç”¨ DOM æŒ‰é’®

âœ… å›ºå®šä½ç½®çš„ UIï¼ˆå¯¹è¯æ¡†ã€èœå•ã€HUDï¼‰
âœ… éœ€è¦å…¼å®¹å¤šç§æµè§ˆå™¨
âœ… ç§»åŠ¨ç«¯æ¸¸æˆ
âœ… å¾®ä¿¡å°æ¸¸æˆ/H5æ¸¸æˆ

### ä½•æ—¶ä½¿ç”¨ Canvas æŒ‰é’®

âœ… æ¸¸æˆå†…çš„åŠ¨æ€å…ƒç´ ï¼ˆè·Ÿéšè§’è‰²çš„æŒ‰é’®ï¼‰
âœ… éœ€è¦æ—‹è½¬ã€ç¼©æ”¾çš„æŒ‰é’®
âœ… çº¯æ¡Œé¢ç«¯æ¸¸æˆ
âœ… éœ€è¦ä¸æ¸¸æˆåœºæ™¯æ·±åº¦é›†æˆ

## æœ€ä½³å®è·µ

1. **æ··åˆä½¿ç”¨**: æ¸¸æˆå†…å…ƒç´ ç”¨ Canvasï¼Œå›ºå®š UI ç”¨ DOM
2. **æ¸…ç†èµ„æº**: å¯¹è¯ç»“æŸæ—¶è®°å¾—ç§»é™¤ DOM å…ƒç´ 
3. **z-index ç®¡ç†**: DOM æŒ‰é’®ä½¿ç”¨é«˜ z-indexï¼ˆ10000+ï¼‰ç¡®ä¿åœ¨æœ€ä¸Šå±‚
4. **è§¦æ‘¸ä¼˜åŒ–**: ç§»åŠ¨ç«¯æŒ‰é’®è¦è¶³å¤Ÿå¤§ï¼ˆæœ€å° 44x44pxï¼‰

## ä»£ç ä½ç½®

ä¿®æ”¹çš„æ–‡ä»¶ï¼š
- `frontend/src/game/managers/DialogueManager.ts`
  - æ·»åŠ  `domButtonsContainer` å±æ€§
  - ä¿®æ”¹ `showResponseOptions()` æ–¹æ³•ä½¿ç”¨ DOM æŒ‰é’®
  - ä¿®æ”¹ `closeDialogue()` æ–¹æ³•æ¸…ç† DOM æŒ‰é’®

## æµ‹è¯•æ–¹æ³•

1. åœ¨å¾®ä¿¡ä¸­æ‰“å¼€æ¸¸æˆ
2. ç‚¹å‡» NPC å¼€å§‹å¯¹è¯
3. ç‚¹å‡»å¯¹è¯æŒ‰é’®ï¼ˆğŸ¤ è¯­éŸ³å›å¤ã€ğŸ’¬ ç»§ç»­å¯¹è¯ç­‰ï¼‰
4. æŒ‰é’®åº”è¯¥å‡†ç¡®å“åº”ç‚¹å‡»ï¼Œæœ‰è§†è§‰åé¦ˆ

## å¸¸è§é—®é¢˜

### Q: DOM æŒ‰é’®ä¼šä¸ä¼šå½±å“æ¸¸æˆæ€§èƒ½ï¼Ÿ
A: ä¸ä¼šã€‚DOM æŒ‰é’®åªåœ¨éœ€è¦æ—¶åˆ›å»ºï¼Œä¸éœ€è¦æ¯å¸§é‡ç»˜ï¼Œæ€§èƒ½åè€Œæ›´å¥½ã€‚

### Q: DOM æŒ‰é’®èƒ½å’Œ Canvas ä¸€èµ·ä½¿ç”¨å—ï¼Ÿ
A: å¯ä»¥ã€‚ä½¿ç”¨ `z-index` æ§åˆ¶å±‚çº§ï¼ŒDOM æŒ‰é’®åœ¨ä¸Šå±‚ï¼ŒCanvas åœ¨ä¸‹å±‚ã€‚

### Q: å¦‚ä½•è°ƒæ•´æŒ‰é’®ä½ç½®ï¼Ÿ
A: ä¿®æ”¹ `bottom`ã€`left` ç­‰ CSS å±æ€§å³å¯ï¼Œéå¸¸ç›´è§‚ã€‚

### Q: æ”¯æŒå…¨å±æ¨¡å¼å—ï¼Ÿ
A: å®Œå…¨æ”¯æŒã€‚`position: fixed` ç›¸å¯¹äºè§†å£ï¼Œä¸å—å…¨å±å½±å“ã€‚

---

**æ€»ç»“**: ä½¿ç”¨ DOM æŒ‰é’®æ˜¯è§£å†³ç§»åŠ¨ç«¯æµè§ˆå™¨ï¼ˆç‰¹åˆ«æ˜¯å¾®ä¿¡æµè§ˆå™¨ï¼‰æŒ‰é’®ç‚¹å‡»é—®é¢˜çš„æœ€ä½³æ–¹æ¡ˆï¼Œç®€å•ã€å¯é ã€å…¼å®¹æ€§å¥½ã€‚
