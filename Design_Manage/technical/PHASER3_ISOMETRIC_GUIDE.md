# ğŸ® Phaser 3 è½´æµ‹å›¾å®ç°æŒ‡å—

## ğŸ¯ ç»“è®ºï¼šä¸éœ€è¦é¢å¤–æ’ä»¶ï¼

Phaser 3 åŸç”Ÿå°±å¯ä»¥å®Œç¾å®ç° 2.5D è½´æµ‹å›¾æ•ˆæœï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯**é¢„æ¸²æŸ“çš„ç­‰è·æŠ•å½±å›¾ç‰‡**ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„ 3D å¯¹è±¡ã€‚

---

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”

### âœ… æ¨èï¼šåŸç”Ÿ Phaser 3ï¼ˆæ— æ’ä»¶ï¼‰

**ä¼˜ç‚¹**ï¼š
- âœ… é›¶ä¾èµ–ï¼Œæ— éœ€å®‰è£…é¢å¤–æ’ä»¶
- âœ… å®Œå…¨æ§åˆ¶ï¼Œçµæ´»åº¦æœ€é«˜
- âœ… æ€§èƒ½æœ€ä¼˜ï¼Œæ— é¢å¤–å¼€é”€
- âœ… ç»´æŠ¤ç®€å•ï¼Œä¸å—æ’ä»¶æ›´æ–°å½±å“
- âœ… ä»£ç æ¸…æ™°ï¼Œæ˜“äºç†è§£å’Œè°ƒè¯•

**å®ç°å†…å®¹**ï¼š
- åæ ‡è½¬æ¢ï¼ˆç½‘æ ¼ â†” å±å¹•ï¼‰
- æ·±åº¦æ’åºï¼ˆè‡ªåŠ¨ Z-indexï¼‰
- ç›¸æœºæ§åˆ¶ï¼ˆæ‹–æ‹½ã€ç¼©æ”¾ï¼‰
- è§’è‰²ç§»åŠ¨ï¼ˆç½‘æ ¼ç§»åŠ¨ï¼‰

### âŒ ä¸æ¨èï¼šphaser3-plugin-isometric

**é—®é¢˜**ï¼š
- âŒ å·²ç» 2+ å¹´æœªæ›´æ–°ï¼ˆæœ€åæ›´æ–° 2022ï¼‰
- âŒ å¯èƒ½ä¸æœ€æ–° Phaser 3 ä¸å…¼å®¹
- âŒ å¢åŠ é¡¹ç›®å¤æ‚åº¦å’Œä¾èµ–
- âŒ ä¸»è¦ç”¨äºçœŸ 3D ç‰©ç†å¼•æ“ï¼Œæˆ‘ä»¬ä¸éœ€è¦

**æ¥æº**ï¼š
- [phaser3-plugin-isometric GitHub](https://github.com/sebashwa/phaser3-plugin-isometric)
- [Phaser Discourse è®¨è®º](https://phaser.discourse.group/t/phaser-3-5-isometric-demo-how-to-continue/8543)

### ğŸ”§ å¯é€‰ï¼šGrid Engineï¼ˆè¾…åŠ©å·¥å…·ï¼‰

**ç”¨é€”**ï¼š
- ç½‘æ ¼ç§»åŠ¨å’Œå¯»è·¯
- è§’è‰²è·¯å¾„è§„åˆ’
- ç¢°æ’æ£€æµ‹

**æ³¨æ„**ï¼š
- è¿™ä¸æ˜¯æ¸²æŸ“æ’ä»¶ï¼Œåªæ˜¯ç§»åŠ¨è¾…åŠ©
- å¯ä»¥åæœŸæ·»åŠ ï¼Œä¸æ˜¯å¿…éœ€çš„

---

## ğŸ’» å·²å®ç°çš„åŠŸèƒ½

æˆ‘å·²ç»ä¸ºä½ åˆ›å»ºäº†å®Œæ•´çš„ `IsometricEngine.ts`ï¼ŒåŒ…å«ï¼š

### 1. IsometricUtilsï¼ˆåæ ‡è½¬æ¢å·¥å…·ï¼‰
```typescript
// ç½‘æ ¼åæ ‡ â†’ å±å¹•åæ ‡
gridToScreen(gridX, gridY) â†’ {x, y}

// å±å¹•åæ ‡ â†’ ç½‘æ ¼åæ ‡
screenToGrid(screenX, screenY) â†’ {x, y}

// è®¡ç®—æ·±åº¦å€¼ï¼ˆç”¨äºè‡ªåŠ¨æ’åºï¼‰
getDepth(gridX, gridY, zOffset) â†’ number
```

### 2. IsometricMapSceneï¼ˆåœ°å›¾åœºæ™¯ï¼‰
```typescript
- å¤šå›¾å±‚ç®¡ç†ï¼ˆåœ°é¢ã€ç‰©ä½“ã€è§’è‰²ï¼‰
- è‡ªåŠ¨æ·±åº¦æ’åº
- ç›¸æœºæ§åˆ¶ï¼ˆæ‹–æ‹½ã€ç¼©æ”¾ï¼‰
- ç‚¹å‡»äº¤äº’
- èµ„äº§åŠ è½½å’Œæ¸²æŸ“
```

### 3. IsometricMapï¼ˆåœ°å›¾æ•°æ®ç®¡ç†ï¼‰
```typescript
- åœ°å›¾æ•°æ®ç»“æ„
- åœ°é¢ç“¦ç‰‡ç®¡ç†
- ç‰©ä½“å’Œè§’è‰²ç®¡ç†
- æ•°æ®ç”Ÿæˆå’ŒåŠ è½½
```

### 4. IsometricCharacterControllerï¼ˆè§’è‰²ç§»åŠ¨ï¼‰
```typescript
- ç½‘æ ¼ç§»åŠ¨
- å¹³æ»‘è¿‡æ¸¡åŠ¨ç”»
- å®æ—¶æ·±åº¦æ›´æ–°
- ç§»åŠ¨çŠ¶æ€ç®¡ç†
```

---

## ğŸ¨ æ ¸å¿ƒåŸç†

### ç­‰è·æŠ•å½±åæ ‡è½¬æ¢

```
å±å¹•åæ ‡ = ç½‘æ ¼åæ ‡ Ã— æŠ•å½±çŸ©é˜µ

screenX = (gridX - gridY) Ã— (tileWidth / 2)
screenY = (gridX + gridY) Ã— (tileHeight / 2)
```

### æ·±åº¦æ’åºç®—æ³•

```
depth = (gridX + gridY) Ã— 1000 + zOffset

è§„åˆ™ï¼š
- gridX + gridY è¶Šå¤§ï¼Œè¶Šé å‰ï¼ˆä¸‹æ–¹ï¼‰
- zOffset ç”¨äºåŒä¸€æ ¼å­å†…çš„é«˜åº¦å·®
- ä¹˜ä»¥ 1000 ç¡®ä¿è¶³å¤Ÿçš„æ’åºç©ºé—´
```

### å›¾å±‚ç»“æ„

```
ä»ä¸‹åˆ°ä¸Šï¼š
1. ground        - åœ°é¢ç“¦ç‰‡ï¼ˆdepth: -1000ï¼‰
2. shadows       - é˜´å½±å±‚ï¼ˆå¯é€‰ï¼‰
3. objects_low   - ä½å±‚ç‰©ä½“ï¼ˆèŠ±å›ç­‰ï¼‰
4. buildings     - å»ºç­‘å±‚
5. characters    - è§’è‰²å±‚ï¼ˆdepth: +100ï¼‰
6. objects_high  - é«˜å±‚ç‰©ä½“ï¼ˆæ ‘æœ¨ã€è·¯ç¯ï¼‰
7. effects       - ç‰¹æ•ˆå±‚ï¼ˆå…‰æ™•ã€ç²’å­ï¼‰
8. ui            - UI å±‚ï¼ˆåç§°ã€ä»»åŠ¡æ ‡è®°ï¼‰
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å®‰è£…ï¼ˆæ— éœ€é¢å¤–ä¾èµ–ï¼‰

é¡¹ç›®å·²ç»æœ‰ Phaser 3ï¼Œç›´æ¥ä½¿ç”¨å³å¯ï¼š

```bash
# å·²ç»åœ¨ package.json ä¸­
"phaser": "^3.60.0"
```

### 2. å¯¼å…¥å’Œä½¿ç”¨

```typescript
// åœ¨ä½ çš„åœºæ™¯æ–‡ä»¶ä¸­
import { IsometricMapScene } from '@/utils/IsometricEngine';

// åœ¨ Phaser é…ç½®ä¸­æ³¨å†Œåœºæ™¯
const config = {
  type: Phaser.AUTO,
  width: 1280,
  height: 720,
  scene: [IsometricMapScene],
  // ...
};

const game = new Phaser.Game(config);
```

### 3. åŠ è½½åœ°å›¾æ•°æ®

```typescript
// ä» JSON åŠ è½½åœ°å›¾æ•°æ®
const mapData = await fetch('/assets/maps/starter_village.json');
const map = new IsometricMap(this, mapData);
```

### 4. æ·»åŠ è§’è‰²ç§»åŠ¨

```typescript
const character = new IsometricCharacterController(
  this,
  sprite,
  startGridX,
  startGridY
);

// ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®
character.moveTo(targetGridX, targetGridY, 200);
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
frontend/src/
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ IsometricEngine.ts      âœ… å·²åˆ›å»ºï¼ˆæ ¸å¿ƒå¼•æ“ï¼‰
â”œâ”€â”€ scenes/
â”‚   â”œâ”€â”€ StarterVillageScene.ts  ğŸ“ å¾…åˆ›å»ºï¼ˆæ–°æ‰‹æ‘åœºæ™¯ï¼‰
â”‚   â””â”€â”€ GameScene.ts             ğŸ“ å¾…åˆ›å»ºï¼ˆä¸»æ¸¸æˆåœºæ™¯ï¼‰
â”œâ”€â”€ data/
â”‚   â””â”€â”€ maps/
â”‚       â””â”€â”€ starter_village.json ğŸ“ å¾…åˆ›å»ºï¼ˆåœ°å›¾æ•°æ®ï¼‰
â””â”€â”€ assets/
    â”œâ”€â”€ tiles/                   ğŸ“ å¾…ç”Ÿæˆï¼ˆåœ°é¢çº¹ç†ï¼‰
    â”œâ”€â”€ buildings/               ğŸ“ å¾…ç”Ÿæˆï¼ˆå»ºç­‘èµ„äº§ï¼‰
    â”œâ”€â”€ decorations/             ğŸ“ å¾…ç”Ÿæˆï¼ˆè£…é¥°èµ„äº§ï¼‰
    â””â”€â”€ characters/              ğŸ“ å¾…ç”Ÿæˆï¼ˆè§’è‰²èµ„äº§ï¼‰
```

---

## ğŸ¯ ä¼˜åŠ¿æ€»ç»“

### ä¸ºä»€ä¹ˆåŸç”Ÿæ–¹æ¡ˆæœ€å¥½ï¼Ÿ

1. **ç®€å•ç›´æ¥**
   - åªéœ€è¦åŸºç¡€çš„åæ ‡è½¬æ¢
   - ä¸éœ€è¦å¤æ‚çš„ 3D ç‰©ç†å¼•æ“
   - ä»£ç é‡å°‘ï¼Œæ˜“äºç»´æŠ¤

2. **æ€§èƒ½ä¼˜ç§€**
   - æ— é¢å¤–æ’ä»¶å¼€é”€
   - ç›´æ¥ä½¿ç”¨ Phaser 3 çš„æ¸²æŸ“ç®¡çº¿
   - æ·±åº¦æ’åºåªåœ¨å¿…è¦æ—¶è¿›è¡Œ

3. **å®Œå…¨æ§åˆ¶**
   - å¯ä»¥è‡ªå®šä¹‰ä»»ä½•è¡Œä¸º
   - ä¸å—æ’ä»¶é™åˆ¶
   - æ˜“äºæ‰©å±•å’Œä¼˜åŒ–

4. **æ— ä¾èµ–é£é™©**
   - ä¸ä¾èµ–ç¬¬ä¸‰æ–¹æ’ä»¶
   - ä¸å—æ’ä»¶æ›´æ–°å½±å“
   - é•¿æœŸç»´æŠ¤æ— å¿§

---

## ğŸ“š å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Phaser 3 å®˜æ–¹æ–‡æ¡£](https://photonstorm.github.io/phaser3-docs/)
- [Phaser 3 ç¤ºä¾‹](https://phaser.io/examples)

### ç¤¾åŒºèµ„æº
- [Creating an Isometric View in Phaser 3](https://tnodes.medium.com/creating-an-isometric-view-in-phaser-3-fada95927835)
- [How to manage big isometric maps with Phaser 3.5](https://www.dynetisgames.com/2022/06/09/update-how-to-manage-big-isometric-maps-with-phaser-3-5/)
- [Phaser Discourse - Isometric Maps](https://phaser.discourse.group/t/isometric-maps/10221)

---

## ğŸ® ä¸‹ä¸€æ­¥

1. **ç”Ÿæˆæ¸¸æˆèµ„äº§** - ä½¿ç”¨ AI_PROMPTS_LIBRARY.md ä¸­çš„æç¤ºè¯
2. **åˆ›å»ºåœ°å›¾æ•°æ®** - æ ¹æ® MAP_DESIGN_STARTER_VILLAGE.md
3. **å®ç°å…·ä½“åœºæ™¯** - åˆ›å»º StarterVillageScene.ts
4. **æ·»åŠ æ¸¸æˆé€»è¾‘** - ä»»åŠ¡ç³»ç»Ÿã€å¯¹è¯ç³»ç»Ÿç­‰

éœ€è¦æˆ‘å¸®ä½ ï¼š
- åˆ›å»ºå…·ä½“çš„åœºæ™¯å®ç°ä»£ç ï¼Ÿ
- è®¾è®¡åœ°å›¾æ•°æ® JSON æ ¼å¼ï¼Ÿ
- å®ç°è§’è‰²åŠ¨ç”»ç³»ç»Ÿï¼Ÿ
- æ·»åŠ ç‚¹å‡»äº¤äº’é€»è¾‘ï¼Ÿ

---

## ğŸ’¡ æ€»ç»“

**ä¸éœ€è¦å®‰è£…ä»»ä½•æ’ä»¶ï¼**

Phaser 3 åŸç”ŸåŠŸèƒ½å®Œå…¨å¤Ÿç”¨ï¼Œæˆ‘å·²ç»ä¸ºä½ åˆ›å»ºäº†å®Œæ•´çš„è½´æµ‹å›¾å¼•æ“ã€‚åªéœ€è¦ï¼š
1. ä½¿ç”¨ `IsometricEngine.ts` ä¸­çš„å·¥å…·
2. æŒ‰ç…§ 2.5D è§„èŒƒç”Ÿæˆèµ„äº§
3. åŠ è½½èµ„äº§å¹¶æ¸²æŸ“å³å¯

è¿™æ˜¯æœ€ç®€å•ã€æœ€é«˜æ•ˆã€æœ€å¯é çš„æ–¹æ¡ˆï¼ğŸ‰
